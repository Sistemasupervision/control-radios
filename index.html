<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control de Radios</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .radio { border: 1px solid #ccc; margin: 10px; padding: 10px; border-radius: 5px; }
    .filtro { margin-bottom: 20px; }
    input, select { padding: 6px; margin-right: 10px; }
  </style>
</head>
<body>
  <h1>ðŸ“¡ Inventario de Radios</h1>

  <div class="filtro">
    <input type="text" id="search" placeholder="Buscar por serial o ID..." />
    <select id="tipo">
      <option value="">Todos los tipos</option>
      <option value="PortÃ¡til Motorola">PortÃ¡til Motorola</option>
      <option value="PortÃ¡til Hytera">PortÃ¡til Hytera</option>
      <option value="MÃ³vil Motorola">MÃ³vil Motorola</option>
    </select>
    <button onclick="cargarRadios()">Filtrar</button>
  </div>

  <div id="radios"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // ðŸ”‘ Reemplaza con tus claves (las encuentras en Settings > API)
    const supabaseUrl = 'https://rgaplyddikcbygzzdpgx.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnYXBseWRkaWtjYnlnenpkcGd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMDY1MDUsImV4cCI6MjA3NzY4MjUwNX0.G8SXKZm2OjJZSclkMiR8o4p9r0pHhmoN3NU0pLMrVF8';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    async function cargarRadios() {
      const search = document.getElementById('search').value.trim().toLowerCase();
      const tipo = document.getElementById('tipo').value;

      let query = supabase.from('radios').select('*').order('numero', { ascending: true });

      if (tipo) query = query.eq('tipo_equipo', tipo);
      if (search) {
        query = query.or(`serial.ilike.%${search}%,codigo_id.ilike.%${search}%`);
      }

      const { data, error } = await query;

      if (error) {
        console.error('Error:', error);
        document.getElementById('radios').innerHTML = '<p>Error al cargar los datos.</p>';
        return;
      }

      const contenedor = document.getElementById('radios');
      if (data.length === 0) {
        contenedor.innerHTML = '<p>No se encontraron radios.</p>';
        return;
      }
// Verificar autenticaciÃ³n
const { data: { user }, error: authError } = await supabase.auth.getUser();
if (!user) {
  window.location.href = 'login.html';
}
      contenedor.innerHTML = data.map(r => `
        <div class="radio">
          <strong>${r.marca} ${r.modelo}</strong> | Serial: ${r.serial} | ID: ${r.codigo_id || 'â€”'}<br>
          Dependencia: ${r.dependencia || 'â€”'} | Tipo: ${r.tipo_equipo}<br>
          ${r.observaciones ? `Obs: ${r.observaciones}` : ''}
        </div>
      `).join('<hr>');
    }

    // Cargar al inicio
    cargarRadios();
  </script>
</body>
</html>
